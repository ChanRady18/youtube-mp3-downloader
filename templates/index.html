<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Playlist / Video to MP3</title>
<style>
    body { font-family: Arial; padding: 20px; background: #f4f4f9; }
    input, button { padding: 10px; }
    .video { display:inline-block; margin:10px; text-align:center; width:220px; }
    img { width:200px; height:120px; display:block; }
    .check-btn { margin:10px 5px 10px 0; display:inline-block; cursor:pointer; color:#fff; background:#4CAF50; padding:8px 12px; border:none; border-radius:5px; }
    .clear-btn { background:#f44336; }
    #message { background:#d4edda; color:#155724; padding:10px; margin-bottom:10px; border-radius:5px; display:none; }

    /* Loading overlay */
    #loadingOverlay {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 9999;
        color: white;
        font-size: 24px;
        text-align: center;
        padding-top: 20%;
    }
</style>
</head>
<body>
<h1>YouTube Playlist / Video to MP3</h1>

<div id="message">{{ message }}</div>

<!-- Loading overlay -->
<div id="loadingOverlay">Preparing File ... Please wait.</div>

<!-- URL form -->
<form method="POST" id="fetchForm">
    <input type="text" name="playlist_url" placeholder="Paste video or playlist URL" style="width:400px;" required>
    <button type="submit">Fetch Videos</button>
</form>

{% if videos %}
<form method="POST" id="downloadForm">
    <button type="button" class="check-btn" id="checkAllBtn">Check / Uncheck All</button>
    <button type="button" class="check-btn clear-btn" id="clearListBtn">Clear List</button>
    <div id="videoList">
        {% for video in videos %}
        <div class="video">
            <img src="{{ video.thumbnail }}" alt="{{ video.title }}">
            <input type="checkbox" name="download_urls[]" value="{{ video.url }}" checked>
            <div>{{ video.title }}</div>
            <div style="font-size:12px; color:#555;">{{ video.url }}</div>
        </div>
        {% endfor %}
    </div>
    <br>
    <button type="submit" style="font-size:18px; color:#fff; background:#21598d; padding:10px 20px; border-radius:5px; text-decoration:none;">Download Selected</button>
</form>
{% endif %}

{% if download_link %}
<div style="margin-top:50px;">
    <h3>Click button below to download MP3(s)</h3>
    <a href="{{ url_for('download_file', filename=download_link) }}" style="font-size:18px; color:#fff; background:#21598d; padding:10px 20px; border-radius:5px; text-decoration:none;">
        Download MP3(s) ZIP
    </a>
</div>
{% endif %}

<script>
window.onload = function() {
    let msg = document.getElementById('message');
    if(msg.innerText.trim() !== ""){
        msg.style.display = 'block';
        setTimeout(() => { msg.style.display = 'none'; }, 5000);
    }

    let checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(c => c.checked = true);

    let btn = document.getElementById('checkAllBtn');
    btn.addEventListener('click', () => {
        let allChecked = Array.from(checkboxes).every(c => c.checked);
        checkboxes.forEach(c => c.checked = !allChecked);
    });

    let clearBtn = document.getElementById('clearListBtn');
    clearBtn.addEventListener('click', () => {
        let videoList = document.getElementById('videoList');
        if(videoList) videoList.innerHTML = '';
    });

    let downloadForm = document.getElementById('downloadForm');
    if(downloadForm){
        downloadForm.addEventListener('submit', function(){
            document.getElementById('loadingOverlay').style.display = 'block';
        });
    }
}
</script>

</body>
</html>
